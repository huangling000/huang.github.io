**共享内存是两个正在运行的进程之间共享和传递数据的一种非常有效的方式。**不同进程之间共享的内存通常为同一段物理内存。进程可以将同一段物理内存连接到他们自己的地址空间中，所有的进程都可以访问共享内存中的地址。

特别提醒：**共享内存并未提供同步机制**，也就是说，在第一个进程结束对共享内存的写操作之前，并无自动机制可以阻止第二个进程开始对它进行读取，所以我们通常需要用其他的机制来同步对共享内存的访问，例如**信号量**。

### 共享内存的通信原理

内存：**进程控制块（PCB）**和**地址空间（Addr Space）**，并有与之对应的一个**页表（负责将虚拟地址与物理地址进行映射）**，通过内存管理单元进行管理。两个不同的虚拟地址通过页表映射到物理空间的同一区域，它们所指向的这块区域即共享内存。

![](https://img-blog.csdn.net/20180416112848158)

我们要确保一个进程在写的时候不能被读，因此我们使用信号量来实现同步与互斥。一个共享内存，实现采用的是引用计数的原理，当进程脱离共享存储区后，计数器减一，挂架成功时，计数器加一，只有当计数器变为零时，才能被删除。当进程终止时，它所附加的共享存储区都会自动脱离。

### 为什么共享内存速度最快？

Proc A 进程给内存中写数据， Proc B 进程从内存中读取数据，在此期间一共发生了两次复制

（1）Proc A 到共享内存    （2）共享内存到 Proc B

因为直接在内存上操作，所以共享内存的速度也就提高了。

### 共享内存的接口函数以及指令

1.查看系统中的共享存储段

```cpp
ipcs -m
```

2.删除系统中的共享存储段

```cpp
ipcrm -m [shmid]
```

3.shmget ( )：创建共享内存

```cpp
int shmget(key_t key, size_t size, int shmflg);
```

（1）优点：我们可以看到使用共享内存进行进程之间的通信是非常方便的，而且函数的接口也比较简单，数据的共享还使进程间的数据不用传送，而是直接访问内存，加快了程序的效率。

（2）缺点：共享内存没有提供同步机制，这使得我们在使用共享内存进行进程之间的通信时，往往需要借助其他手段来保证进程之间的同步工作。